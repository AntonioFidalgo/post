---
title: "Include a Figure in your Report"
author: "Antonio Fidalgo"
date: 2022-02-27
description: "Details on the recommended way of introducing a figure in your report."
tags: ["figures", "R chunk", "path", "chunk options"]
series: ["figures"]
link-citations: true
editPost:
    URL: "https://github.com/AntonioFidalgo/post/blob/main/includefigure/index.Rmd"
    Text: "Rmd Source Code"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = FALSE)
```

There are different ways of introducing a figure in your final report knitted from a Rmd file.[^thisisr] Below are details on the way that I recommend because:  

1. It allows for easy cross-references.
2. It allows for tweaking the appearance of the figure, e.g., its size.
3. It is consistent with the way we code in R, i.e., with R functions in a R chunk.


# Don't Do This

First, let me mention what I **don't recommend**. It's a Markdown code given in the [RMarkdown cheat sheet.](https://raw.githubusercontent.com/rstudio/cheatsheets/main/rmarkdown.pdf) And it looks like:

```markdown
![Caption](image.png)
```

So, in a Rmd file, you would write, for instance:


```markdown
# Introduction

Lore ipsum... see Figure below.

![Caption](image.png)

dolor sit amet.
```

Because of the three reasons above, please just don't do that in your report. 


# Use R Code in a R Chunk

To include a figure in your report, I recommend that you use R code, i.e., a R function, in a R chunk. The best[^best] function is:

```r 
knitr::include_graphics("path to file")
``` 

This R function goes into a R chunk so that your Rmd could look almost like the next example. I say almost because there are still some extra points that I will need to introduce further below.

````
# Introduction

Lore ipsum... see Figure below.

```{r}`r ''`
knitr::include_graphics("path to file")
```

dolor sit amet.
````
 



## Wait... "path to file"?

The path to file... is an advanced topic that I will explain  elsewhere.   

For the time being, if you are not confortable yet with giving a relative path, then adopt the following two safe-mode rules:  

1. Put the picture file (e.g., "image.png") in the same folder as your Rmd (where you are writing). Then, the "path to file" is simply the name of the file, **with the file extension** (!).  

```{r, eval=FALSE}
knitr::include_graphics("image.png")
```

2. Do not use absolute paths! These paths give the full address of the file in **your computer**, e.g.,

```markdown 
"C:\Desktop\mypictures\image.png"
```
```markdown 
"/users/me/Desktop/mypictures/image.png"
```

The problem with absolute paths is that they compromise reproducibility.[^sure] An absolute no go!


# Prepare for Cross-Referecing your Figure

Cross-referencing[^cr] is everywhere in reports. Rmd files allow for automatic cross-references. So, implementing it for your figures in your Rmd should be a no-brainer.   

This requires 3 steps:

1. Give a name to the R chunk.
2. Give a caption to the figure with the chunk option `fig.cap`.
3. Use an output type from the package {bookdown}. 

For **steps 1. and 2.**, here is an example where the name of the chunk is `my-important-fig` and the caption is "This is the caption of my figure.".


````
```{r my-important-fig, fig.cap="This is the caption of my figure."}`r ''`
knitr::include_graphics("image.png")
```
````

As for **step 3.**, you must define in the YAML the option `output` to use a function from the package {bookdown}. The next example allows you to knit to (default versions of) pdf or HTML.

```yaml 
title: "Untitled"
output:
  bookdown::pdf_document2: default
  bookdown::html_document2: default
```



# Tweak the Appearance 
  
To change the appearance of your figure, you must appropriately choose the values in the chunk options. Here are my most common choices.

- `echo = FALSE`, if I want to include an external file.[^ifnot]
- `fig.align = 'center'`, self-explanatory.
- `out.width='66%'`, this lets the size of the figure in the output file to be dependent on the width of this latter. I find that `out.width='100%'` often makes the figures too big. Alternatively, you can manually set the width and the height of the figure in inches with `fig.width = ` and `fig.height = `. I almost never do it![^except] 

Overall, here is what my typical R chunk for a figure looks like.

````
```{r my-important-fig, echo = FALSE, fig.align = 'center', out.width='66%', fig.cap="This is the caption of my figure."}`r ''`
knitr::include_graphics("image.png")
```
````


# Last Comments 

### Automatic Numbering

You shouldn't give a number to your figures.[^figure] This is done automatically. Advanced users can do all kind of fancy stuff. I'm pretty happy with the defaults.  

### Position of the Figure

In HTML output formats, the figure appears where you coded it. Period. 

Some users, however, are surprised with the behavior in the pdf document. This is because the pdf document is generated by $\LaTeX$. Being the best typesetting engine in the world, $\LaTeX$ just "knows better" where to put your figure.  

In short,[^complicated] $\LaTeX$ puts the figure at the top of a page. Great default, used in many scientific papers and books. If you can't break away from the habit of having figures in between your paragraphs, you can tell $\LaTeX$ to put your figure exactly where you coded it.   

For that, use the chunk option and value `fig.pos = 'h!'`. The `h` stands for "here" and the `!` forces $\LaTeX$ to "really" override its default.   

  
 






[^thisisr]: Recall, this is R: there are always multiple ways of obtaining a result.
[^best]: I think it is the best. But, also, I don't want to always repeat "recommended". It's okay, right?
[^sure]: Please make sure that you understand this point.
[^cr]: Recall, there is cross-referencing at play when you read in the final report sentences like : "The results are in Figure 4 of Chapter 5.", i.e., a cross-reference of the figure and a cross-reference of the chapter. Obviously, we want cross-reference to be automatic. 
[^ifnot]: Set to `TRUE`, sometimes, when the figure was generated by R code that you want to show. Rare.
[^except]: Exception: if the figure is tall, constraining it to 66% of the output width smashes it down to much. In those cases, I use `fig.height = 7`.
[^figure]: Nor do you need to write "Figure:" in your caption! This too is automatic, of course!
[^complicated]: It's a bit more complicated than that, but we don't need all the details.